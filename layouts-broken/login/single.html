{{ define "main" }}
<main class="main-content flex items-center justify-center vh-100">
  <div class="pa4 br3 shadow-1 bg-washed-blue mw6 center">
    <h1 class="f3 tc mb4">Sign In or Create Account</h1>

    <div id="login-ui">
      <button onclick="signInWithGoogle()" class="f6 link dim br3 ph4 pv3 mb3 dib white bg-blue w-100">
        Continue with Google
      </button>

      <div class="mv3">
        <input id="email" type="email" placeholder="Email" class="input-reset ba b--black-20 pa2 mb2 w-100">
        <input id="password" type="password" placeholder="Password" class="input-reset ba b--black-20 pa2 mb2 w-100">
      </div>

      <button onclick="emailLogin()" class="f6 link dim br3 ph4 pv3 mb2 dib white bg-green w-100">Sign In</button>
      <button onclick="emailSignup()" class="f6 link dim br3 ph4 pv3 mb2 dib white bg-dark-green w-100">Create Account</button>
    </div>
  </div>
</main>

<script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-auth-compat.js"></script>
<script src="/js/firebase-config.js"></script>

<script>
  if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  function signInWithGoogle() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).then(() => {
      const params = new URLSearchParams(window.location.search);
      window.location.href = params.get("redirect") || "/events";
    }).catch(err => alert(err.message));
  }

  function emailLogin() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    auth.signInWithEmailAndPassword(email, password)
      .then(() => {
        const params = new URLSearchParams(window.location.search);
        window.location.href = params.get("redirect") || "/events";
      })
      .catch(err => alert(err.message));
  }

  function emailSignup() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    auth.createUserWithEmailAndPassword(email, password)
      .then((userCred) => {
        userCred.user.sendEmailVerification();
        alert("Account created! Verification email sent.");
        const params = new URLSearchParams(window.location.search);
        window.location.href = params.get("redirect") || "/events";
      })
      .catch(err => alert(err.message));
  }
</script>
{{ end }}
