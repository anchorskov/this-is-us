rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /*
     * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     * FIRESTORE SECURITY RULES â€“ Identity & Profile Only
     * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     *
     * ARCHITECTURE:
     * - Firestore: User identity and profiles only (users/{uid})
     * - D1 (EVENTS_DB): All civic content (town hall posts, bills, etc.)
     * - Worker API: Server-side writes to D1 (POST /api/townhall/create, etc.)
     *
     * PRINCIPLE: Deny-first, allow minimal
     * - No client-side writes to civic content collections (use Worker API)
     * - Only authenticated users can read/write their own profile
     * - All other collections denied by default
     */

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ğŸ‘¤  USER PROFILES â€“ Identity & Profile Data
       Collection: /users/{userId}
       
       Purpose: Store user profiles (name, email, city, state, preferences)
       
       Access:
         - GET: Only the authenticated user can read their own profile
         - CREATE: Only the user can create their own profile (on signup)
         - UPDATE: Only the user can update their own profile (account settings)
         - DELETE: Only the user can delete their own profile
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    match /users/{userId} {
      // Allow authenticated user to read their own profile
      allow get: if request.auth != null && request.auth.uid == userId;

      // Allow authenticated user to create their own profile
      allow create: if request.auth != null && request.auth.uid == userId;

      // Allow authenticated user to update their own profile
      allow update: if request.auth != null && request.auth.uid == userId;

      // Allow authenticated user to delete their own profile
      allow delete: if request.auth != null && request.auth.uid == userId;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ğŸ”’  DEFAULT DENY ALL OTHER COLLECTIONS
       
       Explicitly deny all other collections:
       - townhall_threads/* (moved to D1 + Worker API)
       - townhall_posts/* (moved to D1 + Worker API)
       - events/* (moved to D1 + Worker API)
       - admin/* (not needed in Firestore)
       - Any other future collections (fail-secure)
       
       All civic content writes must go through Worker endpoints:
       - POST /api/townhall/create â†’ D1 townhall_posts table
       - POST /api/townhall/delete â†’ D1 deletion
       - etc.
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
