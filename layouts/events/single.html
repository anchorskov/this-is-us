{{ define "main" }}
<main class="main-content">
  <article class="post-single">
    <header class="post-header">
      <h1 class="post-title">{{ .Title }}</h1>
    </header>

    <div class="post-content">
      {{ .Content }}
      <div id="greeting"></div>
      <div id="event-form" style="display: none;">
        <h3>Submit a New Event</h3>
        <form id="eventForm">
          <input name="title" placeholder="Event Title" required />
          <input name="datetime" type="datetime-local" required />
          <textarea name="description" placeholder="Event Description" required></textarea>
          <button type="submit">Submit Event</button>
        </form>
      </div>
    </div>
  </article>
</main>

<script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-auth-compat.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const firebaseConfig = {
      apiKey: "AIzaSyB2JqSDeOgNOdMHCfHqaC78Rgr-l7LqIkU",
      authDomain: "this-is-us-events.firebaseapp.com",
      projectId: "this-is-us-events",
      storageBucket: "this-is-us-events.firebasestorage.app",
      messagingSenderId: "215038360222",
      appId: "1:215038360222:web:98677c77158d282c9ad98f"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    const greet = document.getElementById("greeting");
    const form = document.getElementById("event-form");

    auth.onAuthStateChanged(user => {
      if (!user) {
        auth.signInAnonymously();
        greet.innerHTML = "<p>Welcome.</p>";
      } else if (user.isAnonymous) {
        greet.innerHTML = "<p>Welcome.</p>";
        form.style.display = "none";
      } else {
        greet.innerHTML = `<p>Hello, ${user.displayName || user.email}</p>`;
        form.style.display = "block";
      }
    });

    document.getElementById("eventForm")?.addEventListener("submit", e => {
      e.preventDefault();
      alert("Form submitted (backend wiring not implemented here).");
    });
  });
</script>
{{ end }}
