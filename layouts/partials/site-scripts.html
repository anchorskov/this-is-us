{{- /* -------------------------------------------------------------------
     File: layouts/partials/head.html (updated 2025â€‘07â€‘14)
     Purpose: central place for <head> tags + early APIâ€‘root probe.
     ------------------------------------------------------------------- */ -}}

<!DOCTYPE html>
<html lang="en">
<head>
  {{/* Existing head metadata, styles, etc. remain above */}}

  {{/* â”€â”€ Dynamic APIâ€‘root probe (runs before any ESâ€‘module) â”€â”€ */}}
  <script>
  (function () {
    const isLocalHugo = location.hostname === "localhost" && location.port === "1313";

    /* Default mapping
         â€¢ prod build  â†’  /api
         â€¢ hugo server â†’  remote Worker on production */
    window.EVENTS_API_URL = isLocalHugo ? "https://this-is-us.org/api" : "/api";

    /* Optional: detect wranglerâ€‘dev Worker on http://127.0.0.1:8787 */
    if (isLocalHugo) {
      const local = "http://127.0.0.1:8787";
      fetch(local + "/api/_health", { mode: "no-cors" })
        .then(() => {
          window.EVENTS_API_URL = local + "/api";
          console.log("ğŸ”„ Local Worker detected â€“ API â†’", window.EVENTS_API_URL);
        })
        .catch(() => {
          console.log("ğŸ› Using remote Worker â†’", window.EVENTS_API_URL);
        });
    } else {
      console.log("ğŸŒ Using API â†’", window.EVENTS_API_URL);
    }
  })();
  </script>

  <!-- Preâ€‘load helper so every ESâ€‘module can import apiRoot() -->
  <script type="module" src="/js/lib/api-root.js"></script>

  {{/* keep existing head elements (title, meta, styles) below */}}
  {{ partial "extend_head.html" . }}
</head>
<body>
