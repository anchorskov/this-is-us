{{ define "main" }}
<div class="max-w-xl w-full bg-white rounded-2xl shadow p-6 space-y-6 mx-auto mt-8">
  <h1 class="text-2xl font-bold text-center text-gray-800">Submit Your Candidacy</h1>
  <p class="text-gray-600 text-center">
    Tell us your name, the office you're running for, and your location. Attach a PDF so our users can check out your platform — exactly as you want it shared.
  </p>

  <form id="uploadForm" class="space-y-4">
    <label class="block">
      <span class="text-gray-700 font-medium">Candidate PDF</span>
      <input type="file" name="file" accept="application/pdf" required
             class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" />
    </label>

    <button type="submit"
            class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition">
      Submit PDF
    </button>
  </form>

  <div id="result" class="hidden border border-gray-200 rounded-md p-4 mt-4 text-sm"></div>
</div>

<script>
  const form = document.getElementById('uploadForm');
  const resultDiv = document.getElementById('result');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const fileInput = form.querySelector('input[type="file"]');
    const file = fileInput.files[0];
    if (!file) return alert("Please upload a PDF file.");

    const formData = new FormData();
    formData.append("file", file);

    resultDiv.classList.add("hidden");
    resultDiv.innerHTML = "Processing your submission...";

    try {
      const upload = await fetch("/api/candidates/upload", {
        method: "POST",
        body: formData
      });

      const response = await upload.json();
      resultDiv.classList.remove("hidden");

      if (response.success) {
        const c = response.candidate || {};
        resultDiv.innerHTML = `
          <p class="font-semibold text-green-600">Success! Your submission was received.</p>
          <p><strong>Name:</strong> ${c.name || '—'}</p>
          <p><strong>Office:</strong> ${c.office || '—'}</p>
          <p><strong>Location:</strong> ${c.location || '—'}</p>
          <p><a class="text-blue-600 underline" href="${response.pdf_url}" target="_blank">View Original PDF</a></p>
        `;
      } else {
        resultDiv.innerHTML = `<p class="text-red-600 font-semibold">Error: ${response.error || 'Unknown issue'}</p>`;
      }
    } catch (err) {
      resultDiv.classList.remove("hidden");
      resultDiv.innerHTML = `<p class="text-red-600 font-semibold">Upload failed. Please try again.</p>`;
    }
  });
</script>
{{ end }}
