{{ define "main" }}
<main class="main-content">
  <article class="post-single">
    <header class="post-header">
      <h1 class="post-title">{{ .Title }}</h1>
    </header>

    <div class="post-content">
      {{ .Content }}
    </div>
  </article>
</main>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-auth-compat.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const firebaseConfig = {
      apiKey: "AIzaSyB2JqSDeOgNOdMHCfHqaC78Rgr-l7LqIkU",
      authDomain: "this-is-us-events.firebaseapp.com",
      projectId: "this-is-us-events",
      storageBucket: "this-is-us-events.firebasestorage.app",
      messagingSenderId: "215038360222",
      appId: "1:215038360222:web:98677c77158d282c9ad98f"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    const box = document.getElementById("auth-box");
    if (!box) return;

    box.innerHTML = `
      <p>Login or Create an Account</p>
      <button onclick="signInWithGoogle()" class="btn btn--primary">Continue with Google</button>
      <hr/>
      <input type="email" id="email" placeholder="Email" />
      <input type="password" id="password" placeholder="Password" />
      <button onclick="loginEmail()" class="btn">Sign In</button>
      <button onclick="signupEmail()" class="btn btn--primary">Create Account</button>
    `;

    window.signInWithGoogle = function () {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).then(() => {
        window.location.href = "/events";
      }).catch(err => alert(err.message));
    };

    window.loginEmail = function () {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, password).then(() => {
        window.location.href = "/events";
      }).catch(err => alert("Login failed: " + err.message));
    };

    window.signupEmail = function () {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.createUserWithEmailAndPassword(email, password).then(() => {
        window.location.href = "/events";
      }).catch(err => alert("Signup failed: " + err.message));
    };
  });
</script>
{{ end }}
