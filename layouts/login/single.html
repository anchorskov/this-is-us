{{ define "main" }}
<main class="main-content">
  <article class="post-single">
    <header class="post-header">
      <h1 class="post-title">{{ .Title }}</h1>
    </header>

    <div class="post-content">
      {{ .Content }}
      <div id="auth-box"></div>
    </div>
  </article>
</main>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-auth-compat.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const firebaseConfig = {
      apiKey: "AIzaSyB2JqSDeOgNOdMHCfHqaC78Rgr-l7LqIkU",
      authDomain: "this-is-us-events.firebaseapp.com",
      projectId: "this-is-us-events",
      storageBucket: "this-is-us-events.firebasestorage.app",
      messagingSenderId: "215038360222",
      appId: "1:215038360222:web:98677c77158d282c9ad98f"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    const box = document.getElementById("auth-box");
    if (!box) return;

    box.innerHTML = `
      <div class="pa4 measure center br3 shadow-1 bg-washed-blue">
        <h2 class="f4 fw6 tc mb4">Sign in or Create Account</h2>

        <button onclick="signInWithGoogle()" class="f6 link dim br3 ph3 pv2 mb3 dib white bg-dark-blue w-100">
          Continue with Google
        </button>

        <div class="mb3">
          <label class="db fw6 lh-copy f6" for="email">Email</label>
          <input class="pa2 input-reset ba b--black-20 bg-white w-100" type="email" id="email" name="email">
        </div>

        <div class="mb3">
          <label class="db fw6 lh-copy f6" for="password">Password</label>
          <input class="pa2 input-reset ba b--black-20 bg-white w-100" type="password" id="password" name="password">
        </div>

        <button onclick="loginEmail()" class="f6 link dim br3 ph3 pv2 mb2 dib white bg-blue w-100">
          Sign In
        </button>
        <button onclick="signupEmail()" class="f6 link dim br3 ph3 pv2 dib white bg-green w-100">
          Create Account
        </button>

        <p class="tc mt3">
          <a href="/events" class="link dim blue">‚Üê Back to Events</a>
        </p>
      </div>
    `;

    window.signInWithGoogle = function () {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).then(() => {
        window.location.href = "/events";
      }).catch(err => alert(err.message));
    };

    window.loginEmail = function () {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, password).then(() => {
        window.location.href = "/events";
      }).catch(err => alert("Login failed: " + err.message));
    };

    window.signupEmail = function () {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.createUserWithEmailAndPassword(email, password).then(userCred => {
        userCred.user.sendEmailVerification();
        alert("Verification email sent! Please check your inbox.");
        window.location.href = "/events";
      }).catch(err => alert("Signup failed: " + err.message));
    };
  });
</script>
{{ end }}
