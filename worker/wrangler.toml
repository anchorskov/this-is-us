name               = "this-is-us-events"
main               = "src/index.mjs"
compatibility_date = "2025-05-05"
account_id         = "8bfd3f60fbdcc89183e9e312fb03e86e"

# ─── Firebase project ID (shared dev + prod) ─────────────────────────
[vars]
FIREBASE_PROJECT_ID   = "this-is-us-events"
FIREBASE_CLIENT_EMAIL = "firebase-adminsdk@this-is-us.iam.gserviceaccount.com"
FIREBASE_PRIVATE_KEY  = "${FIREBASE_PRIVATE_KEY}"
OPENSTATES_API_KEY    = "34c97a5b-a758-407a-961f-7bfd54460c5c"
OPENAI_API_KEY        = "${OPENAI_API_KEY}"

[env.production.triggers]
crons = ["0 3 * * 1"] # Mondays at 03:00 UTC (weekly pending-bills refresh)

# ✅ Enable bindings for local development
[[d1_databases]]
binding       = "EVENTS_DB"
database_name = "events_db_local"
database_id   = "6c3fffd4-e6dc-47b8-b541-3857c2882e0c"
migrations_dir = "migrations"

[[d1_databases]]
binding = "BALLOT_DB"
database_name = "ballot_sources"
database_id   = "9c4b0c27-eb33-46e6-a477-fb49d4c81474"

[[d1_databases]]
binding       = "WY_DB"
database_name = "wy"
database_id   = "4b4227f1-bf30-4fcf-8a08-6967b536a5ab"
migrations_dir = "migrations_wy"

[[r2_buckets]]
binding             = "EVENT_PDFS"
bucket_name         = "event-pdfs-bucket"
preview_bucket_name = "event-pdfs-bucket-preview"

# ✅ Preview / staging environment
[env.preview]
main         = "src/index.mjs"
workers_dev  = true

[env.preview.vars]
FIREBASE_PROJECT_ID   = "this-is-us-events"
FIREBASE_CLIENT_EMAIL = "firebase-adminsdk@this-is-us.iam.gserviceaccount.com"
FIREBASE_PRIVATE_KEY  = "${FIREBASE_PRIVATE_KEY}"
OPENSTATES_API_KEY    = "34c97a5b-a758-407a-961f-7bfd54460c5c"
OPENAI_API_KEY        = "${OPENAI_API_KEY}"

[[env.preview.d1_databases]]
binding       = "EVENTS_DB"
database_name = "events_db_preview"
database_id   = "1624450c-f228-4802-8a76-9c65f29295fa"

[[env.preview.d1_databases]]
binding       = "BALLOT_DB"
database_name = "ballot_sources"
database_id   = "9c4b0c27-eb33-46e6-a477-fb49d4c81474"

[[env.preview.d1_databases]]
binding       = "WY_DB"
database_name = "wy_preview"
database_id   = "de78cb41-176d-40e8-bd3b-e053e347ac3f"
migrations_dir = "migrations_wy"

# ✅ Production environment configuration
[env.production]
main    = "src/index.mjs"
zone_id = "b298c4645feb8f945eb1a0950eb24323"

routes  = [ "https://this-is-us.org/api/*" ]

[env.production.vars]
FIREBASE_PROJECT_ID   = "this-is-us-events"
FIREBASE_CLIENT_EMAIL = "firebase-adminsdk@this-is-us.iam.gserviceaccount.com"
FIREBASE_PRIVATE_KEY  = "${FIREBASE_PRIVATE_KEY}"
OPENSTATES_API_KEY    = "34c97a5b-a758-407a-961f-7bfd54460c5c"
OPENAI_API_KEY        = "${OPENAI_API_KEY}"

[[env.production.d1_databases]]
binding              = "EVENTS_DB"
database_name        = "events_db"
database_id          = "b5814930-2779-4bfb-8052-24ee419e09fd"
preview_database_id  = "1624450c-f228-4802-8a76-9c65f29295fa"

[[env.production.d1_databases]]
binding       = "BALLOT_DB"
database_name = "ballot_sources"
database_id   = "9c4b0c27-eb33-46e6-a477-fb49d4c81474"

[[env.production.d1_databases]]
binding              = "WY_DB"
database_name        = "wy"
database_id          = "4b4227f1-bf30-4fcf-8a08-6967b536a5ab"
preview_database_id  = "de78cb41-176d-40e8-bd3b-e053e347ac3f"
migrations_dir       = "migrations_wy"

[[env.production.r2_buckets]]
binding             = "EVENT_PDFS"
bucket_name         = "event-pdfs-bucket"
preview_bucket_name = "event-pdfs-bucket-preview"
